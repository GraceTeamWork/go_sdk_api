package test

import (
	"fmt"
	"github.com/gin-gonic/gin"
	"io/ioutil"
	"log"
	"math/rand"
	"net/http"
	"net/url"
	"time"
)

func Callback(c *gin.Context) {

	t1 := time.Now()
	for i := 0; i < 30; i++ {

		wg.Add(1)
		go httpCallback(i)
	}

	wg.Wait()
	t2 := time.Now()
	fmt.Println("ok")
	fmt.Println(t1)
	fmt.Println(t2)
}

func httpCallback(j int) {

	defer wg.Done()

	var param = url.Values{}

	url := "http://127.0.0.1:9003/channel/fengling/callback/5001"

	rand.Seed(time.Now().UnixNano())

	for i := 0; i <= 1000; i++ {
		param.Set("nt_data", "@117@112@176@160@157@88@175@149@164@163@155@162@164@111@83@105@97@100@87@80@157@158@153@165@156@154@164@151@115@88@136@138@127@94@112@85@81@171@173@145@160@148@147@159@165@160@150@117@85@162@164@82@119@110@114@167@173@154@153@155@169@154@158@149@166@150@171@166@146@159@158@110@110@157@151@166@169@147@152@157@113@112@158@163@151@164@155@169@172@111@103@108@101@159@166@149@173@150@171@167@111@116@156@152@147@158@160@152@162@112@97@116@98@151@157@145@166@158@155@162@118@109@153@152@151@164@161@155@165@144@166@148@158@157@119@108@97@147@154@148@164@160@150@164@146@162@150@157@157@110@114@153@160@146@164@158@155@162@146@171@162@149@118@99@150@110@114@104@147@104@152@153@153@99@146@104@148@154@107@98@106@147@109@152@108@149@152@99@153@152@106@107@105@148@155@115@144@96@98@108@97@147@154@148@164@160@150@164@146@169@158@148@118@108@153@158@153@159@164@149@162@149@162@168@157@150@170@113@109@103@156@152@147@158@160@152@162@145@160@170@151@153@167@110@116@151@151@163@157@144@165@162@154@155@165@116@107@97@106@99@97@111@106@101@99@103@99@100@104@100@101@105@104@102@113@95@159@145@163@155@151@160@168@148@155@168@113@114@168@163@156@152@163@151@167@159@112@96@98@99@104@98@99@104@99@107@102@101@105@103@103@103@106@99@111@101@108@102@100@106@109@104@107@111@96@167@171@148@151@162@145@161@165@112@109@168@148@173@148@164@161@157@155@116@106@97@104@96@99@102@106@99@106@102@88@100@104@114@106@97@108@98@100@111@101@162@146@177@146@168@158@157@157@110@114@151@165@160@171@158@170@116@105@106@113@95@104@99@109@103@154@157@161@165@160@167@116@110@164@172@148@168@170@163@118@96@114@101@171@165@151@164@171@169@113@114@158@169@172@165@146@171@152@160@147@162@147@160@169@112@99@104@101@100@101@103@105@101@103@109@105@98@104@98@106@103@104@104@181@157@177@108@98@109@117@95@151@168@166@165@151@165@144@168@148@166@150@157@171@110@114@101@165@150@169@163@151@157@152@116@117@96@169@168@154@155@164@163@150@155@145@160@155@165@164@153@154@153@115")
		param.Set("sign", "@113@147@107@101@98@153@109@147@151@147@152@105@108@149@102@155@104@152@151@146@104@149@109@152@106@151@111@102@104@107@107@107")
		param.Set("md5Sign", "2481cf37c61c7e310fb9cad55ef78469")
		resp, err := http.PostForm(url, param)
		if err != nil {
			log.Fatal(err)
			return
		}
		defer resp.Body.Close()

		body, err := ioutil.ReadAll(resp.Body)
		if err != nil {
			fmt.Println(err)
		}

		fmt.Println(string(body))
	}
}
